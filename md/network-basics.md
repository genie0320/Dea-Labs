# Amplify에 도메인 연결하기

## 사건의 발단
www, dev 등의 서브도메인은 의도대로 활성이 되는데, 무슨 짓을 해도 루트도메인 활성화가 안되는 상황에서... 도메인업체가 aws의 가이드가 제공하는 방식을 사용할 수 없도록 막아놓은 상태에 직면했다.

## 도메인과 DNS
도메인을 구입하면 익숙한 www가 붙지 않은 순정 그 상태, 즉 `루트도메인`을 소유하게 된다.
즉, www.google.com 이 아닌, google.com 을 소유하게 된다.

앞에 www 등이 붙은 것을 서브도메인이라고 하는데, 내가 소유한 도메인에 www, dev등을 붙여서 전혀 다른 서비스를 제공할 수도 있다. 즉 www.naver.com 으로 접속하면 포탈이 뜨지만, blog.naver.com으로 접속하면 블로그서비스의 메인화면이 뜨는 것 처럼 말이다.

일반적으로 루트도메인을 활성화하기 위해서는 다음의 2개의 방법이 있다. 

### 1. DNS정보에 ANAME/ALIAS 데이터를 추가하는 방법.
이것이 Amplify에서 제공하는 normal한 방법이다. 문제는 ANAME 데이터는 ip 형태인데, Amplify에서 제공하는 정보는 url의 형태이다. 그런경우, arias 데이터 형태를 선택하면, url형태의 입력이 가능하나, 내가 사용중인 호스팅케이알에서는 arias라는 DNS정보 형태가 옵션에 없었다. 

어제 밤부터 이걸 연결하겠다고 온갖 쌩쇼를 하면서 온라인을 뒤졌는데...
~~참고로, stack overflow에서는 arias를 지원하지 않는 호스팅업체는 쓰지 말아라...고까지 하더라.~~
> ### **CNAME(Alias)레코드**
>
>루트 도메인(예:hosting.kr)에  CNAME 설정할 수 없는 제약을 해결할 수 있는 레코드입니다. 
루트 도메인에 도메인 주소를 입력하여 CNAME 처럼 사용할 수 있습니다.
>
> ※단, 호스팅케이알의 클라우드 네임서버에서만 지원이 가능합니다.


### 2. 네임서버 정보인 ns 정보를 추가하는 방법.
아쉽게도 aws amplify 에서는 ns 정보를 제공하지 않는다. 때문에 아마도 원천적으로 arias 정보를 입력할 수 없게 해 놓은 호스팅케이알에 묶여 있는 한, 나는 Route53이라는 도메인네임서비스를 이용해야 한다. 즉, Route53에 arias를 등록하고, 할당된 ns정보를 도메인업체의 네임서버정보란에 입력하는 삽질을 한단계 더 거쳐야 한다는 뜻.

(한글 블로그) [Amplify에 Route53를 붙이는 방법](https://brunch.co.kr/@topasvga/49)<br>
(영문 동영상) [How To Add A Custom Domain To An AWS Amplify App With Route53](https://www.youtube.com/watch?v=gldpw-WNbrU)

## 결론적으로.
내가 호스팅케이알을 이용하는 한, 루트도메인을 활성화하기 위해서는 Route53서비스를 추가구매할 수 밖에 없는 상황인 듯 하다. 하지만, 지금으로선 서브도메인들만 가지고도 충분히 운영이 가능하니, 일단 도메인 갱신기간인 올해 7월까지는 이대로 잘 버텨볼 생각이다.

`(다음 글 예고) 도메인 기관이전하는 법(호스팅케이알 > 다른업체)`
## 참고
### DNS데이터의 유형
다음의 유형을 보면, 호스팅케이알에서 얼마나 @##^&$%#^%$한 짓을 해 놓은 것인지 알 수 있다. 내가 수단방법 가리지 않고 다음번 구매떄는 기관이전을 하리라.
>#### **A레코드**
>호스트 이름을 IPv4 주소로 매핑하는 주소 레코드입니다. 일반적으로 흔히 알고 있는 IP 형태로만 설정이 가능합니다. 
>
>예 ) 121.254.170.11

>#### **AAAA레코드**
>호스트 이름을 IPv6 주소에 매핑하는 IPv6 주소 레코드입니다. IPv6주소는 16비트씩 8부분으로 16진수로 이루어집니다.
>
>예 ) 2001:0230:abcd:ffff:0000:0000:ffff:1111
>
>`※단, 호스팅케이알의 클라우드 네임서버에서만 지원이 가능합니다.`

> #### **CNAME**
>별칭 이름을 지정하는 표준 이름 레코드입니다.
>`루트 도메인(예:hosting.kr)에 CNAME 설정을 할 수 없습니다.`

> #### **CNAME(Alias)레코드**
>루트 도메인(예:hosting.kr)에  CNAME 설정할 수 없는 제약을 해결할 수 있는 레코드입니다.
>루트 도메인에 도메인 주소를 입력하여 CNAME 처럼 사용할 수 있습니다.
>
>`※단, 호스팅케이알의 클라우드 네임서버에서만 지원이 가능합니다.`

>#### **MX 레코드**
>메일 수발신을 위한 레코드입니다. 
>도메인으로 메일을 사용하기 위해서는 필수입니다.

>#### **SPF 레코드**
>화이트도메인 등록을 위해 추가하는 레코드로,  발송 메일 서버를 인증하는 역할을 합니다.
>메일 수신서버가 발송서버의 IP를 확인하고 SPF 레코드와 일치하지 않을 경우 반송처리를 하게됩니다.
>호스팅케이알의 클라우드 네임서버에서는 TXT와 SPF 레코드를 구분하여 설정하며, 이전 기본 호스팅케이알 네임서버에서는  TXT레코드로 지정하여 SPF값을 설정하게 됩니다.

>#### **SRV레코드**
>서비스 로케이터 레코드로 TCP/IP 서비스를 제공하는 다수의 서버 위치 정보를 제공합니다.

>#### **TXT레코드**
>텍스트 레코드입니다. 임의 텍스트가 포함될 수 있으며 도메인 소유권 인증 등과 같이 보안 및 악용방지 하는 데 사용됩니다.
>TXT 레코드는 하나 이상의 텍스트 문자열을 포함할 수 있으며, 각 개별 문자열의 최대 길이는 255자(영문 기준)입니다.


 
# Misc.


### Ports
- Alternatively, since ```127.0.0.1``` is aliased with 'localhost', you could also enter ```localhost:5500```.
- Websites are typically served on ports 80 (HTTP) or 443 (HTTPS)
- You can use ANY ports that are typically not used by any other processes - 5500, 3000 or 8080 are common choices because they aren't typically used by other processes.
